<div class="right_col" role="main">
  <div class="page-title">
    <div class="title_left">
      <h1>Facturas de ventas</h1>
      <h2>XML sin timbrar</h2>
      <!-- @xml -->
      <h2>registro del emisor</h2>
      <%= @regEmisor%>
      <h2>XML sellado y timbrado</h2>
      <%= @tim%>
      <h2>variables</h2>
      <%= @total_to_w%>
    </div>
  </div>

  <div class="clearfix"></div>
  <hr>
  <div class="row">
    <div class="div-add-button">
        <%= link_to 'Facturar una venta', facturas_facturaDeVentas_path, class: "btn btn-info btn-lg btn-add",id: "anadir-factura-btn" %>
    </div>
  </div> <!--Fin de botón -->



  <% if @consulta %>
  <div class="row">
    <div class="col-md-12" style="color: gray;">
        Se <% if @facturas.size == 1 %>encontró<% else %>encontraron<% end %> <span style="color:#5B7ECC; font-size: 20px;"><%= @facturas.size %></span> factura<% if @facturas.size > 1 %>s<% end %>.
    </div>
  </div>
    <div class="row">
      <div class="col-md-12" style="color: gray;">
        <%if @fechas%>
        <div class="col-md-12">
          Rango de fechas: <span style="color:#5B7ECC; font-size: 16px;"> <%= @fechaInicial %> <span style="color: gray;"> a</span> <%= @fechaFinal %></span>
        </div>
        <%end%>
        <% if @por_folio%>
          <div class="col-md-12">
            Folio de factura: <span style="color:#5B7ECC; font-size: 16px;"> <%=@folio_fact%></span>
          </div>
        <%end%>
        <% if @por_cliente%>
          <div class="col-md-12">
            RFC del cliente: <span style="color:#5B7ECC; font-size: 16px;"> <%=@rfc%></span>
          </div>
        <%end%>
        <% if @avanzada %>
          <div class="col-md-12">
            Rango de fechas: <span style="color:#5B7ECC; font-size: 16px;"> <%= @fechaInicial %> <span style="color: gray;"> a</span> <%= @fechaFinal %></span>
          </div>
          <div class="col-md-12">
          <% if @cajero %>
            Cajero: <span style="color:#5B7ECC; font-size: 16px;"> <%= @cajero.perfil.nombre %></span>
          <% else %>
            Cajero: <span style="color:#5B7ECC; font-size: 16px;"> Todos</span>
          <% end %>
          </div>
          <div class="col-md-12"> <!--poner condiciones de status-->
            Status: <span style="color:#5B7ECC; font-size: 16px;"> <%= @estado_factura %></span>
          </div>
          <% if can? :create, Negocio %>
            <div class="col-md-12">
              <% if @sucursal %>
                Sucursal: <span style="color:#5B7ECC; font-size: 16px;"> <%= @sucursal.nombre %></span>
              <% else %>
                Sucursal: <span style="color:#5B7ECC; font-size: 16px;"> Todas </span>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
    <%end%>









  <hr style="border-style: solid; border-width: 2px;">



    <button id="filtro_por_fecha" class="btn btn-primary" style="margin-bottom: 30px; display: inline-block;">
      Filtros por fecha <i class="fa fa-sort-down"></i>
    </button>
    <!-- Este buscador sencillo, permite al usuario buscar ventas realizadas en determinado rango de fechas -->
    <div class="row opciones_filtros" style="margin-bottom: 30px;" id="opciones_filtros_por_fecha">
      <%= form_tag({ controller: "facturas", action: "consulta_facturas" }, {:class=> "form-horizontal", :method => :post}) do %>
        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            Búsqueda por fechas:
          </div>
        </div>

        <div class="col-md-1 col-sm-1 col-xs-1">
          <div style="text-align: right; color: black;">
            Desde:
          </div>
        </div>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            <%= date_picker_tag("fecha_inicial", nil, {class: "form-control", selectMonths: :true}, {})%>
          </div>
        </div>

        <div class="col-md-1 col-sm-1 col-xs-1">
          <div style="text-align: right; color: black;">
            Hasta:
          </div>
        </div>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            <%= date_picker_tag("fecha_final", nil, {class: "form-control"}, {})%>

          </div>
        </div>

        <div class="col-md-1 col-sm-5 col-xs-12">
          <div class="text-center">
            <%= submit_tag 'Consultar facturas', {:class=>"btn btn-info"} %>
          </div>
        </div>
      <% end %>
    </div> <!--Fin de busqueda por fecha-->
    <!-- Termina buscador por rango de fechas -->


    <button id="filtro_por_folio" class="btn btn-primary" style="margin-bottom: 30px; display: inline-block;">
      Filtros por folio <i class="fa fa-sort-down"></i>
    </button>
    <!-- Este form permite buscar las facturas de acuerdo al folio ingresado-->
    <div class="row opciones_filtros" style="margin-bottom: 30px;" id="opciones_filtros_por_folio">
      <%= form_tag({ controller: "facturas", action: "consulta_por_folio" }, {:class=> "form-horizontal", :method => :post}) do %>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            Filtro por folio de factura:
          </div>
        </div>

        <div class="col-md-1 col-sm-1 col-xs-1">
          <div style="text-align: right; color: black;">
            Folio:
          </div>
        </div>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            <%= text_field_tag :folio_fact, nil, {class: "form-control col-md-7 col-xs-12 text_field", :placeholder=>"Folio de factura..."} do%>
              <span class="input-group-addon"><i class="fa fa-barcode"></i></span>
            <%end%>
          </div>
        </div>

        <div class="col-md-1 col-sm-5 col-xs-12">
          <div class="text-center">
            <%= submit_tag 'Filtrar por folio', {:class=>"btn btn-info"} %>
          </div>
        </div>

      <% end %>
    </div>
    <!-- Termina buscador por clave de producto -->

    <button id="filtro_por_cliente" class="btn btn-primary" style="margin-bottom: 30px; display: inline-block;">
      Filtros por cliente<i class="fa fa-sort-down"></i>
    </button>
    <!-- Permite realizar una busqueda de la facturas de un cliente en específico -->
    <div class="row opciones_filtros" style="margin-bottom: 30px;" id="opciones_filtros_por_cliente">
      <%= form_tag({ controller: "facturas", action: "consulta_por_cliente" }, {:class=> "form-horizontal", :method => :post}) do %>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            Filtro por cliente:
          </div>
        </div>

        <div class="col-md-1 col-sm-1 col-xs-1">
          <div style="text-align: right; color: black;">
            RFC:
          </div>
        </div>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            <%= text_field_tag :rfc, nil, {class: "form-control col-md-7 col-xs-12 text_field", :placeholder=>"RFC del cliente..."} do%>
              <span class="input-group-addon"><i class="fa fa-barcode"></i></span>
            <%end%>
          </div>
        </div>

        <div class="col-md-1 col-sm-5 col-xs-12">
          <div class="text-center">
            <%= submit_tag 'Filtrar por cliente', {:class=>"btn btn-info"} %>
          </div>
        </div>

      <% end %>
    </div>
    <!-- Termina buscador por atributos del cliente-->





    <!-- Este botón despliega el div con las opciones para filtros avanzados -->
    <button id="filtros_avanzados" class="btn btn-primary" style="margin-bottom: 30px; display: inline-block;">
      Filtros Avanzados <i class="fa fa-sort-down"></i>
    </button>

    <!-- Los filtros avanzados permiten al usuario "filtrar ventas" dependiendo de uno o más criterios, pudiendo estos ser combinables entre sí. -->
    <div id="opciones_filtros_avanzados" class="opciones_filtros row">
      <%= form_tag({ controller: "facturas", action: "consulta_avanzada" }, {:class=> "form-horizontal", :method => :post}) do %>
        <div class="item form-group">
          <div class="col-md-6 col-sm-6 col-xs-12">
            <div style="text-align: left; color: black;">
              Elija un conjunto de criterios para hacer un filtro más detallado.
            </div>
          </div>
        </div>
        <div class="item form-group">
          <div class="col-md-3 col-sm-6 col-xs-12">
            <div style="text-align: right;">
              Seleccione un rango de fechas:
            </div>
          </div>

          <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="text-center">
              <%= date_picker_tag("fecha_inicial_avanzado", nil, {class: "form-control text_field", selectMonths: :true}, {})%>
            </div>
          </div>

          <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="text-center">
              <%= date_picker_tag("fecha_final_avanzado", nil, {class: "form-control text_field"}, {})%>

            </div>
          </div>
        </div>

        <div class="item form-group">
          <div class="col-md-3 col-sm-6 col-xs-12">
            <div style="text-align: right;">
              Cajero:
            </div>
          </div>
          <div class="col-md-3 col-sm-6 col-xs-12">
            <div style="text-align: right;">
              <%= collection_select(nil, :perfil_id, @cajeros, :id, :nombre, {:prompt => 'Elija un cajero'}, { class: "form-control col-md-7 col-xs-12" })%>
            </div>
          </div>
        </div>

        <div class="item form-group">
          <div class="col-md-3 col-sm-6 col-xs-12">
            <div style="text-align: right;">
              Status de factura:
            </div>
          </div>
          <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="text-center">
              <%= select_tag "estado_factura", "<option>Todas</option><option>Cerrada</option><option>Borrador</option><option>Abierta</option><option>Anulada</option>".html_safe,  class: 'form-control' %>
            </div>
          </div>
        </div>

        <% if can? :create, Negocio %>

          <div class="item form-group">
            <div class="col-md-3 col-sm-6 col-xs-12">
              <div style="text-align: right;">
                Sucursal:
              </div>
            </div>
            <div class="col-md-3 col-sm-6 col-xs-12">
              <div class="text-center">
                <%= collection_select(nil, :suc_elegida, @sucursales, :id, :nombre, {:prompt => 'Seleccione sucursal'}, { class: "form-control col-md-7 col-xs-12" })%>
              </div>
            </div>
          </div>

        <% end %>

        <div class="item form-group">
          <div class="col-md-3 col-sm-6 col-xs-12">

          </div>
          <div class="col-md-3 col-sm-6 col-xs-12">
            <div class="text-left">
              <%= submit_tag 'Consulta avanzada', {:class=>"btn btn-info"} %>
            </div>
          </div>
        </div>
      <% end %>
    </div>





<div class="col-md-12 col-sm-12 col-xs-12">
  <div class="row">
    <div>
      <table class="table table-striped responsive-utilities jambo_table data-table">
        <thead>
          <tr>
            <th style="text-align: center;">Folio</th>
            <th style="text-align: center;">Cliente </th>
            <th style="text-align: center;">Fecha</th>
            <th style="text-align: center;">Total</th>
            <th style="text-align: center;">Pagado</th>
            <th style="text-align: center;">Por pagar</th>
            <th style="text-align: center;">Estado</th>
            <th style="text-align: center;">Acciones</th>
          </tr>
        </thead>

        <tbody>
          <% @facturas.each do |factura| %>
            <tr>
              <td style="text-align: center;"><%= factura.folio %></td>
              <td style="text-align: center;"><%= factura.cliente.nombre %></td>
              <td style="text-align: center;"><%=factura.fecha_expedicion %></td>
              <td style="text-align: center;"><%=factura.venta.montoVenta %></td>

              <%if factura.forma_pago.nombre.eql?("efectivo")%>
              <td style="text-align: center;"><%=factura.venta.montoVenta%></td>
              <%end%>
              <td style="text-align: center;"><%= %></td>

              <td style="text-align: center;">
                <% if factura.estado_factura.eql?("Cerrada") %>
                  <span class="btn btn-success"> Cerrada </span>
                <%elsif factura.estado_factura.eql?("Borrador")%>
                  <span class="btn btn-info"> Borrador </span>
                <%elsif factura.estado_factura.eql?("Abierta")%>
                  <span class="btn btn-warning"> Abierta </span>
                <%elsif factura.estado_factura.eql?("Anulada")%>
                  <span class="btn btn-danger"> Anulada </span>
                <%end%>
              </td>
              <td style="text-align: center;" >
                <% if can? :read, factura %>
                  <%= link_to url={action: "show", controller: "facturas", id: factura}, html_options = {class: "btn btn-info", remote: true , title: 'Detalles factura', 'data-toggle' => 'tooltip', 'data-placement' => 'top'} do %>
                  <i class="fa fa-info-circle"></i>
                  <% end %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>

      </div>
    </div>
    <%= render 'modalFacturas'%>
  </div>

  <script>
    $(document).ready(function(){

      $('.data-table').DataTable({
        responsive: true,
        "language":{
          "info": "Mostrar pag _PAGE_ de _PAGES_",PUEV15
          "lengthMenu": "Mostrar _MENU_ registros",
          "zeroRecords": "No hay coincidencias",
          "search": "Buscar: _INPUT_",
          "infoFiltered": " - encontrados en _MAX_ registros",
          "paginate": {
            "previous": "Anterior",
            "next" : "siguiente",
            "last" : "último",
            "first" : "primero"
          }
        }
      });
    });
  </script>
    <%= javascript_include_tag "facturas" %> <!-- config => initializer => assets-->
    <%= javascript_include_tag "ventas" %>
</div>
