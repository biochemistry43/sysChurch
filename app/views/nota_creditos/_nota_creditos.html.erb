<div class="right_col" role="main">
  <div class="page-title">
    <div class="title_left">
      <h1>Notas de Crédito</h1>
    </div>
  </div>

  <div class="clearfix"></div>
  <hr>
  <div class="row">
    <div class="div-add-button">
        <!-- link_to 'Nueva nota de crédito', new_nota_credito_path, class: "btn btn-info btn-lg btn-add",id: "anadir-factura-btn" -->
    </div>
  </div> <!--Fin de botón -->

  <hr style="border-style: solid; border-width: 2px;">

    <button id="filtro_por_fecha" class="btn btn-primary" style="margin-bottom: 30px; display: inline-block;">
      Filtros por fecha <i class="fa fa-sort-down"></i>
    </button>
    <!-- Este buscador sencillo, permite al usuario buscar ventas realizadas en determinado rango de fechas -->
    <div class="row opciones_filtros" style="margin-bottom: 30px;" id="opciones_filtros_por_fecha">
      <%= form_tag({ controller: "nota_creditos", action: "consulta_por_fecha" }, {:class=> "form-horizontal", :method => :post}) do %>
        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            Búsqueda por fechas:
          </div>
        </div>

        <div class="col-md-1 col-sm-1 col-xs-1">
          <div style="text-align: right; color: black;">
            Desde:
          </div>
        </div>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            <%= date_picker_tag("fecha_inicial", nil, {class: "form-control", selectMonths: :true}, {})%>
          </div>
        </div>

        <div class="col-md-1 col-sm-1 col-xs-1">
          <div style="text-align: right; color: black;">
            Hasta:
          </div>
        </div>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            <%= date_picker_tag("fecha_final", nil, {class: "form-control"}, {})%>

          </div>
        </div>

        <div class="col-md-1 col-sm-5 col-xs-12">
          <div class="text-center">
            <%= submit_tag 'Consultar notas de crédito', {:class=>"btn btn-info"} %>
          </div>
        </div>
      <% end %>
    </div> <!--Fin de busqueda por fecha-->
    <!-- Termina buscador por rango de fechas -->

    <button id="filtro_por_folio" class="btn btn-primary" style="margin-bottom: 30px; display: inline-block;">
      Filtros por folio <i class="fa fa-sort-down"></i>
    </button>
    <!-- Este form permite buscar las facturas de acuerdo al folio ingresado-->
    <div class="row opciones_filtros" style="margin-bottom: 30px;" id="opciones_filtros_por_folio">
      <%= form_tag({ controller: "nota_creditos", action: "consulta_por_folio" }, {:class=> "form-horizontal", :method => :post}) do %>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">

                Filtro por folio de notas de crédito:
          </div>
        </div>

        <div class="col-md-1 col-sm-1 col-xs-1">
          <div style="text-align: right; color: black;">
            Folio:
          </div>
        </div>

        <div class="col-md-2 col-sm-6 col-xs-12">
          <div class="text-center">
            <%= text_field_tag :folio_nc, nil, {class: "form-control col-md-7 col-xs-12 text_field", :placeholder=>"Folio de la nota..."} do%>
              <span class="input-group-addon"><i class="fa fa-barcode"></i></span>
            <%end%>
          </div>
        </div>

        <div class="col-md-1 col-sm-5 col-xs-12">
          <div class="text-center">
            <%= submit_tag 'Filtrar por folio', {:class=>"btn btn-info"} %>
          </div>
        </div>

      <% end %>
    </div>
    <!-- Termina buscador por folio de notas de crédito -->

   <!-- Este botón despliega el div con las opciones para filtros avanzados -->
   <button id="filtros_avanzados" class="btn btn-primary" style="margin-bottom: 30px; display: inline-block;">
     Filtros Avanzados <i class="fa fa-sort-down"></i>
   </button>

   <!-- Los filtros avanzados permiten al usuario "filtrar ventas" dependiendo de uno o más criterios, pudiendo estos ser combinables entre sí. -->
   <div id="opciones_filtros_avanzados" class="opciones_filtros row">
     <%= form_tag({ controller: "facturas", action: "consulta_avanzada" }, {:class=> "form-horizontal", :method => :post}) do %>
       <div class="item form-group">
         <div class="col-md-6 col-sm-6 col-xs-12">
           <div style="text-align: left; color: black;">
             Elija un conjunto de criterios para hacer un filtro más detallado.
           </div>
         </div>
       </div>
       <div class="item form-group">
         <div class="col-md-3 col-sm-6 col-xs-12">
           <div style="text-align: right;">
             Seleccione un rango de fechas:
           </div>
         </div>

         <div class="col-md-3 col-sm-6 col-xs-12">
           <div class="text-center">
             <%= date_picker_tag("fecha_inicial_avanzado", nil, {class: "form-control text_field", selectMonths: :true}, {})%>
           </div>
         </div>

         <div class="col-md-3 col-sm-6 col-xs-12">
           <div class="text-center">
             <%= date_picker_tag("fecha_final_avanzado", nil, {class: "form-control text_field"}, {})%>

           </div>
         </div>
       </div>


       <div class="item form-group">
         <div class="col-md-3 col-sm-6 col-xs-12">
           <div style="text-align: right;">
             Status de factura:
           </div>
         </div>
         <div class="col-md-3 col-sm-6 col-xs-12">
           <div class="text-center">
             <%= select_tag "estado_factura", "<option>Todas</option><option>Cerrada</option><option>Borrador</option><option>Abierta</option><option>Anulada</option>".html_safe,  class: 'form-control' %>
           </div>
         </div>
       </div>

       <% if can? :create, Negocio %>

         <div class="item form-group">
           <div class="col-md-3 col-sm-6 col-xs-12">
             <div style="text-align: right;">
               Sucursal:
             </div>
           </div>
           <div class="col-md-3 col-sm-6 col-xs-12">
             <div class="text-center">
               <!-- collection_select(nil, :suc_elegida, @sucursales, :id, :nombre, {:prompt => 'Seleccione sucursal'}, { class: "form-control col-md-7 col-xs-12" })-->
             </div>
           </div>
         </div>

         <% end %>

         <div class="item form-group">
           <div class="col-md-3 col-sm-6 col-xs-12">

           </div>
           <div class="col-md-3 col-sm-6 col-xs-12">
             <div class="text-left">
               <%= submit_tag 'Consulta avanzada', {:class=>"btn btn-info"} %>
             </div>
           </div>
         </div>
      <% end %>
    </div>

    <!--Lista de todas las notas de crédito -->
    <div class="col-md-12 col-sm-12 col-xs-12">
      <div class="row">
        <div>
          <table class="table table-striped responsive-utilities jambo_table data-table">
            <thead>
              <tr>
                <th style="text-align: center;">Folio</th>
                <th style="text-align: center;">Cliente </th>
                <th style="text-align: center;">Fecha</th>
                <th style="text-align: center;">Total</th>
                <th style="text-align: center;">Estado</th>
                <th style="text-align: center;">Acciones</th>
              </tr>
            </thead>

            <tbody>
              <% @nota_creditos.each do |nc| %>
                <tr>
                  <td style="text-align: center;"><%= nc.folio %></td>
                  <td style="text-align: center;"><%= nc.cliente.nombre_completo%></td>
                  <td style="text-align: center;"><%= nc.fecha_expedicion%></td>
                  <td style="text-align: center;"><%= %></td>
                  <!--Por el momento solo dos estados -->
                  <td style="text-align: center;">
                    <% if nc.estado_nc.eql?("Activa") %>
                      <span class="btn btn-success"> Activa </span>
                    <%elsif nc.estado_nc.eql?("Cancelada")%>
                      <span class="btn btn-danger"> Cancelada</span>
                    <%end%>
                  </td>
                  <td style="text-align: center;" >
                    <!--Imprimir factura-->

                      <%= link_to url={action: "imprimirpdf", controller: "nota_creditos", id: nc}, html_options={class: "btn btn-primary",  title: 'Imprimir', 'data-toggle' => 'tooltip', 'data-placement' => 'top', :target => '_blank'} do %>
                        <i class="fa fa-print"></i>
                      <% end %>


                  </td>

                </tr>
              <% end %>
            </tbody>
          </table>

          </div>
        </div>
        <!-- render 'modalFacturas'-->
      </div>

      <script>
        $(document).ready(function(){

          $('.data-table').DataTable({
            responsive: true,
            "language":{
              "info": "Mostrar pag _PAGE_ de _PAGES_",
              "lengthMenu": "Mostrar _MENU_ registros",
              "zeroRecords": "No hay coincidencias",
              "search": "Buscar: _INPUT_",
              "infoFiltered": " - encontrados en _MAX_ registros",
              "paginate": {
                "previous": "Anterior",
                "next" : "siguiente",
                "last" : "último",
                "first" : "primero"
              }
            }
          });
        });

        $(document).ready(function(){
            $("#filtros_avanzados").click(function(e){
              if( $("#opciones_filtros_avanzados").is(":visible") ){
                $(this).html('Filtros Avanzados <i class="fa fa-sort-down"></i>');
              }
              else{
                $(this).html('Filtros Avanzados <i class="fa fa-sort-up"></i>');
              }
              $("#opciones_filtros_avanzados").slideToggle("fast");
            });

            $("#filtro_por_folio").click(function(e){
              if( $("#opciones_filtros_por_folio").is(":visible") ){
                 $(this).html('Filtros por folio <i class="fa fa-sort-down"></i>');
              }
              else{
                $(this).html('Filtros por folio <i class="fa fa-sort-up"></i>');
              }

              $("#opciones_filtros_por_folio").slideToggle("fast");

            });

            $("#filtro_por_fecha").click(function(e){
              if( $("#opciones_filtros_por_fecha").is(":visible") ){
                 $(this).html('Filtros por fecha <i class="fa fa-sort-down"></i>');
              }
              else{
                $(this).html('Filtros por fecha <i class="fa fa-sort-up"></i>');
              }

              $("#opciones_filtros_por_fecha").slideToggle("fast");

            });



        });
      </script>

</div>
